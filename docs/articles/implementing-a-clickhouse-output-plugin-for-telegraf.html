<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="A process of implementing a Go-based ClickHouse output plugin for Telegraf, along with the surprises and pitfalls.">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@_d1823">
    <meta property="og:url" content="https://1823.pl/articles/implementing-a-clickhouse-output-plugin-for-telegraf">
    <meta property="og:title" content="Implementing a ClickHouse output plugin for Telegraf in Go - d1823.pl">
    <meta property="og:description" content="A process of implementing a Go-based ClickHouse output plugin for Telegraf, along with the surprises and pitfalls.">

    <base href="https://1823.pl/">

    <title>Implementing a ClickHouse output plugin for Telegraf in Go - d1823.pl</title>

    <style>
        /*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */

/* Document
========================================================================== */

/**
 * 1. Correct the line height in all browsers.
 * 2. Prevent adjustments of font size after orientation changes in iOS.
 */

html {
  line-height: 1.15; /* 1 */
  -webkit-text-size-adjust: 100%; /* 2 */
}

/* Sections
========================================================================== */

/**
 * Remove the margin in all browsers.
 */

body {
  margin: 0;
}

/**
 * Render the `main` element consistently in IE.
 */

main {
  display: block;
}

/**
 * Correct the font size and margin on `h1` elements within `section` and
 * `article` contexts in Chrome, Firefox, and Safari.
 */

h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

/* Grouping content
========================================================================== */

/**
 * 1. Add the correct box sizing in Firefox.
 * 2. Show the overflow in Edge and IE.
 */

hr {
  box-sizing: content-box; /* 1 */
  height: 0; /* 1 */
  overflow: visible; /* 2 */
}

/**
 * 1. Correct the inheritance and scaling of font size in all browsers.
 * 2. Correct the odd `em` font sizing in all browsers.
 */

pre {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}

/* Text-level semantics
========================================================================== */

/**
 * Remove the gray background on active links in IE 10.
 */

a {
  background-color: transparent;
}

/**
 * 1. Remove the bottom border in Chrome 57-
 * 2. Add the correct text decoration in Chrome, Edge, IE, Opera, and Safari.
 */

abbr[title] {
  border-bottom: none; /* 1 */
  text-decoration: underline; /* 2 */
  text-decoration: underline dotted; /* 2 */
}

/**
 * Add the correct font weight in Chrome, Edge, and Safari.
 */

b,
strong {
  font-weight: bolder;
}

/**
 * 1. Correct the inheritance and scaling of font size in all browsers.
 * 2. Correct the odd `em` font sizing in all browsers.
 */

code,
kbd,
samp {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}

/**
 * Add the correct font size in all browsers.
 */

small {
  font-size: 80%;
}

/**
 * Prevent `sub` and `sup` elements from affecting the line height in
 * all browsers.
 */

sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sub {
  bottom: -0.25em;
}

sup {
  top: -0.5em;
}

/* Embedded content
========================================================================== */

/**
 * Remove the border on images inside links in IE 10.
 */

img {
  border-style: none;
}

/* Forms
========================================================================== */

/**
 * 1. Change the font styles in all browsers.
 * 2. Remove the margin in Firefox and Safari.
 */

button,
input,
optgroup,
select,
textarea {
  font-family: inherit; /* 1 */
  font-size: 100%; /* 1 */
  line-height: 1.15; /* 1 */
  margin: 0; /* 2 */
}

/**
 * Show the overflow in IE.
 * 1. Show the overflow in Edge.
 */

button,
input { /* 1 */
  overflow: visible;
}

/**
 * Remove the inheritance of text transform in Edge, Firefox, and IE.
 * 1. Remove the inheritance of text transform in Firefox.
 */

button,
select { /* 1 */
  text-transform: none;
}

/**
 * Correct the inability to style clickable types in iOS and Safari.
 */

button,
[type="button"],
[type="reset"],
[type="submit"] {
  -webkit-appearance: button;
}

/**
 * Remove the inner border and padding in Firefox.
 */

button::-moz-focus-inner,
[type="button"]::-moz-focus-inner,
[type="reset"]::-moz-focus-inner,
[type="submit"]::-moz-focus-inner {
  border-style: none;
  padding: 0;
}

/**
 * Restore the focus styles unset by the previous rule.
 */

button:-moz-focusring,
[type="button"]:-moz-focusring,
[type="reset"]:-moz-focusring,
[type="submit"]:-moz-focusring {
  outline: 1px dotted ButtonText;
}

/**
 * Correct the padding in Firefox.
 */

fieldset {
  padding: 0.35em 0.75em 0.625em;
}

/**
 * 1. Correct the text wrapping in Edge and IE.
 * 2. Correct the color inheritance from `fieldset` elements in IE.
 * 3. Remove the padding so developers are not caught out when they zero out
 *    `fieldset` elements in all browsers.
 */

legend {
  box-sizing: border-box; /* 1 */
  color: inherit; /* 2 */
  display: table; /* 1 */
  max-width: 100%; /* 1 */
  padding: 0; /* 3 */
  white-space: normal; /* 1 */
}

/**
 * Add the correct vertical alignment in Chrome, Firefox, and Opera.
 */

progress {
  vertical-align: baseline;
}

/**
 * Remove the default vertical scrollbar in IE 10+.
 */

textarea {
  overflow: auto;
}

/**
 * 1. Add the correct box sizing in IE 10.
 * 2. Remove the padding in IE 10.
 */

[type="checkbox"],
[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}

/**
 * Correct the cursor style of increment and decrement buttons in Chrome.
 */

[type="number"]::-webkit-inner-spin-button,
[type="number"]::-webkit-outer-spin-button {
  height: auto;
}

/**
 * 1. Correct the odd appearance in Chrome and Safari.
 * 2. Correct the outline style in Safari.
 */

[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  outline-offset: -2px; /* 2 */
}

/**
 * Remove the inner padding in Chrome and Safari on macOS.
 */

[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}

/**
 * 1. Correct the inability to style clickable types in iOS and Safari.
 * 2. Change font properties to `inherit` in Safari.
 */

::-webkit-file-upload-button {
  -webkit-appearance: button; /* 1 */
  font: inherit; /* 2 */
}

/* Interactive
========================================================================== */

/*
 * Add the correct display in Edge, IE 10+, and Firefox.
 */

details {
  display: block;
}

/*
 * Add the correct display in all browsers.
 */

summary {
  display: list-item;
}

/* Misc
========================================================================== */

/**
 * Add the correct display in IE 10+.
 */

template {
  display: none;
}

/**
 * Add the correct display in IE 10.
 */

[hidden] {
  display: none;
}

/* Webfont: LatoLatin-Black */@font-face {
    font-family: 'LatoLatinWebBlack';
    src: url('fonts/LatoLatin-Black.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-Black.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-Black.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-Black.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-Black.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-BlackItalic */@font-face {
    font-family: 'LatoLatinWebBlack';
    src: url('fonts/LatoLatin-BlackItalic.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-BlackItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-BlackItalic.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-BlackItalic.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-BlackItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Bold */@font-face {
    font-family: 'LatoLatinWeb';
    src: url('fonts/LatoLatin-Bold.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-Bold.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-Bold.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-Bold.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-Bold.ttf') format('truetype');
    font-style: normal;
    font-weight: bold;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-BoldItalic */@font-face {
    font-family: 'LatoLatinWeb';
    src: url('fonts/LatoLatin-BoldItalic.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-BoldItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-BoldItalic.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-BoldItalic.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-BoldItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: bold;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Hairline */@font-face {
    font-family: 'LatoLatinWebHairline';
    src: url('fonts/LatoLatin-Hairline.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-Hairline.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-Hairline.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-Hairline.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-Hairline.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-HairlineItalic */@font-face {
    font-family: 'LatoLatinWebHairline';
    src: url('fonts/LatoLatin-HairlineItalic.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-HairlineItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-HairlineItalic.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-HairlineItalic.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-HairlineItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Heavy */@font-face {
    font-family: 'LatoLatinWebHeavy';
    src: url('fonts/LatoLatin-Heavy.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-Heavy.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-Heavy.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-Heavy.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-Heavy.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-HeavyItalic */@font-face {
    font-family: 'LatoLatinWebHeavy';
    src: url('fonts/LatoLatin-HeavyItalic.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-HeavyItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-HeavyItalic.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-HeavyItalic.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-HeavyItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Italic */@font-face {
    font-family: 'LatoLatinWeb';
    src: url('fonts/LatoLatin-Italic.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-Italic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-Italic.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-Italic.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-Italic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Light */@font-face {
    font-family: 'LatoLatinWebLight';
    src: url('fonts/LatoLatin-Light.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-Light.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-Light.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-Light.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-Light.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-LightItalic */@font-face {
    font-family: 'LatoLatinWebLight';
    src: url('fonts/LatoLatin-LightItalic.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-LightItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-LightItalic.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-LightItalic.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-LightItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Medium */@font-face {
    font-family: 'LatoLatinWebMedium';
    src: url('fonts/LatoLatin-Medium.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-Medium.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-Medium.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-Medium.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-Medium.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-MediumItalic */@font-face {
    font-family: 'LatoLatinWebMedium';
    src: url('fonts/LatoLatin-MediumItalic.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-MediumItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-MediumItalic.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-MediumItalic.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-MediumItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Regular */@font-face {
    font-family: 'LatoLatinWeb';
    src: url('fonts/LatoLatin-Regular.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-Regular.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-Regular.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-Regular.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-Regular.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Semibold */@font-face {
    font-family: 'LatoLatinWebSemibold';
    src: url('fonts/LatoLatin-Semibold.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-Semibold.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-Semibold.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-Semibold.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-Semibold.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-SemiboldItalic */@font-face {
    font-family: 'LatoLatinWebSemibold';
    src: url('fonts/LatoLatin-SemiboldItalic.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-SemiboldItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-SemiboldItalic.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-SemiboldItalic.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-SemiboldItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-Thin */@font-face {
    font-family: 'LatoLatinWebThin';
    src: url('fonts/LatoLatin-Thin.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-Thin.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-Thin.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-Thin.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-Thin.ttf') format('truetype');
    font-style: normal;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

/* Webfont: LatoLatin-ThinItalic */@font-face {
    font-family: 'LatoLatinWebThin';
    src: url('fonts/LatoLatin-ThinItalic.eot'); /* IE9 Compat Modes */
    src: url('fonts/LatoLatin-ThinItalic.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
         url('fonts/LatoLatin-ThinItalic.woff2') format('woff2'), /* Modern Browsers */
         url('fonts/LatoLatin-ThinItalic.woff') format('woff'), /* Modern Browsers */
         url('fonts/LatoLatin-ThinItalic.ttf') format('truetype');
    font-style: italic;
    font-weight: normal;
    text-rendering: optimizeLegibility;
}

:root {
  --color-background: #FEFEFE;
  --color-foreground: #222;
  --color-link-foreground: var(--color-foreground);
  --color-link-highlighted-foreground: var(--color-link-foreground);
  --color-highlight: #F7BF05;
  --color-highlighted-foreground: var(--color-foreground);
  --color-muted-background: #E5E5E5;
  --color-muted-foreground-1: #999;
  --color-muted-foreground-2: #777;
  --color-code-background: #F6F6F6;
  --color-code-border: #DDD;
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-background: #222;
    --color-foreground: #DDD;
    --color-link-highlighted-foreground: #333;
    --color-highlight: #F7BF05;
    --color-highlighted-foreground: #333;
    --color-muted-background: #444;
    --color-muted-foreground-1: #CCC;
    --color-muted-foreground-2: #AAA;
    --color-code-background: #444;
    --color-code-border: #555;
  }

  img {
    filter: brightness(.8) contrast(1.2);
  }
}

html, body {
  font-family: LatoLatinWeb, Helvetica, Arial, sans-serif;
  color: var(--color-foreground);
  display: flex;
  justify-content: center;
  font-size: 15px;
}

body {
  width: 100%;
  box-sizing: border-box;
  padding: 0.5rem;
}

a {
  text-decoration-color: var(--color-highlight);
  text-decoration-thickness: 0.13em;
  color: var(--color-link-foreground);
}

a:hover {
  text-decoration-line: none;
}

.link--current {
  background: var(--color-highlight);
  color: var(--color-link-highlighted-foreground)
}

.link--current:hover {
  text-decoration-line: underline;
  text-decoration-color: var(--color-link-highlighted-foreground);
}

body {
  background: var(--color-background);
  display: flex;
  align-items: center;
  flex-direction: column;
  margin: 1rem;
}

header {
  width: 100%;
  display: flex;
  gap: 1rem;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 5rem;
}

header #logo, header #logo img {
  max-width: 10rem;
}

header nav {
  display: inline-flex;
  gap: .5rem;
}

nav a {
  display: inline-flex;
  gap: .5rem;
}

.icon__github {
  fill: var(--color-foreground);
  width: 1rem;
  height: auto;
}

#articles {
  width: 100%;
  line-height: 1.6em;
}

#articles .article-link {
  font-size: 1.4rem;
  display: flex;
  align-content: center;
}

#articles .article-link:not(:first-of-type) {
  margin-top: 0.8em;
}

.article-link a {
  display: inline-block;
  background: var(--color-highlight);
  color: var(--color-highlighted-foreground);
  font-weight: bold;
  padding: .2em .4em;
  margin-right: .2em;
  text-decoration: none;
}

.article-link a:hover {
  text-decoration: underline;
  text-decoration-thickness: 0.1em;
}

.article-link .article-link__date {
  background: var(--color-muted-background);
  color: var(--color-muted-foreground-1);
  font-size: .7em;
  margin-right: .5em;
  padding: .2em .5em;
  font-weight: bold;
}

.page {
  width: 100%;
}

.page__header {
  display: inline;
  font-size: 1.6rem;
  line-height: 1.6em;
}

.page__content {
  line-height: 1.8rem;
  font-size: 1.1rem
}

.page__content figure {
  background: var(--color-code-background);
  padding: 1em;
  margin: 2em 0;
  border: 2px dashed var(--color-code-border);
  text-align: center;
}

.page__content figure figcaption {
  padding: .5em;
  font-size: .8em;
}

.page__content figure img {
  max-width: 100%;
}

.page__content > pre,
.page__content > .sourceCode {
  background: var(--color-code-background);
  padding: 1em;
  border: 2px dashed var(--color-code-border);
  word-break: break-all;
  word-wrap: break-word;
  margin: 2em 0;
}

.page__content > .sourceCode pre {
  margin: 0;
}

.page__content pre code {
  padding: 0;
  font-size: .9em;
  color: inherit;
  white-space: pre-wrap;
  background-color: transparent;
  border-radius: 0;
  line-height: 1.4rem;
}

.page__content p > code {
  background: var(--color-code-background);
  border: 1px dashed var(--color-code-border);
  padding: 0 .5em;
  white-space: nowrap;
}

.header__title {
  background: var(--color-highlight);
  color: var(--color-highlighted-foreground);
  display: inline-block;
  font-size: 1em;
  font-weight: bold;
  padding: 0 .4em;
}

.header__meta {
  color: var(--color-muted-foreground-1);
  font-size: .6em;
}

.header__meta a {
  color: var(--color-muted-foreground-2);
}

footer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 100%;
  margin: 4rem;
  font-size: .8rem;
  gap: .5rem;
}

footer > div {
  text-align: center;
}

.me-image {
  width: 70%;
  height: auto;
  border: 3px solid var(--color-highlight);
}

@media screen and (min-width: 1280px) {
  html, body {
    font-size: 16px;
    padding: 1rem;
  }

  body {
    width: 1024px;
  }

  .page__content > pre,
  .page__content > .sourceCode,
  .page__content figure {
    margin-left: -1.5em;
    margin-right: -1.5em;
  }

  header nav {
    font-size: 1.1rem;
    gap: 3rem;
  }

  header #logo {
    width: unset;
  }

  #articles {
    font-size: 1.4rem;
  }

  .header__title {
    padding: 0 .4em;
  }

  .article-link a {
    padding: 0 .4em;
  }

  .article-link .article-link__date {
    padding: 0 .5em;
  }

  .me-image {
    float: right;
    width: 40%;
    margin-left: 5rem;
  }
}
a.sourceLine {
  display: inline-block;
  line-height: 1.25;
}

a.sourceLine {
  pointer-events: none;
  color: inherit;
  text-decoration: inherit;
}

a.sourceLine:empty {
  height: 1.2em;
}

@media print {
  a.sourceLine {
    text-indent: -1em;
    padding-left: 1em;
  }
}

pre.numberSource a.sourceLine {
  position: relative;
  left: -4em;
}

pre.numberSource a.sourceLine::before {
  content: attr(title);
  position: relative;
  left: -1em;
  text-align: right;
  vertical-align: baseline;
  border: none;
  pointer-events: all;
  display: inline-block;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  padding: 0 4px;
  width: 4em;
}

pre.numberSource {
  margin-left: 3em;
  padding-left: 4px;
}

div.sourceCode {}

@media screen {
  a.sourceLine::before {
    text-decoration: underline;
  }
}

/* Alert */
code span.al {
  font-weight: bold;
}

/* Annotation */
code span.an {
  font-style: italic;
}

/* ControlFlow */
code span.cf {
  font-weight: bold;
}

/* Comment */
code span.co {
  font-style: italic;
}

/* CommentVar */
code span.cv {
  font-style: italic;
}

/* Documentation */
code span.do {
  font-style: italic;
}

/* DataType */
code span.dt {
  text-decoration: underline;
}

/* Error */
code span.er {
  font-weight: bold;
}

/* Information */
code span.in {
  font-style: italic;
}

/* Keyword */
code span.kw {
  font-weight: bold;
}

/* Preprocessor */
code span.pp {
  font-weight: bold;
}

/* Warning */
code span.wa {
  font-style: italic;
}
    </style>

    <link
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TRZGKQzuoCGaoThZERRy1CkWoEGqFVh1MLv2CJg1Jiouj4Fpw8GOx6uDirKuDqyAIfoC4ujgpukiJ/0sKLWI8OO7Hu3uPu3eAUC8zzeoYBzTdNlOJuJjJropdrwhiAGEMIyQzy5iTpCR8x9c9Any9i/Es/3N/jl41ZzEgIBLPMsO0iTeIpzdtg/M+cYQVZZX4nHjMpAsSP3Jd8fiNc8FlgWdGzHRqnjhCLBbaWGljVjQ14iniqKrplC9kPFY5b3HWylXWvCd/YSinryxzneYQEljEEiSIUFBFCWXYiNGqk2IhRftxH/+g65fIpZCrBEaOBVSgQXb94H/wu1srPznhJYXiQOeL43yMAF27QKPmON/HjtM4AYLPwJXe8lfqwMwn6bWWFj0C+raBi+uWpuwBlztA/5Mhm7IrBWkK+TzwfkbflAXCt0DPmtdbcx+nD0CaukreAAeHwGiBstd93t3d3tu/Z5r9/QBS3nKamEF+kgAAAAZiS0dEAP0AcAA7rB2u5wAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cDGRUMGX8XZQgAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAC/0lEQVR42u3by2sTQRwH8O/MbJPYpm9bU6qJEm1BPbSCgiDqTWxFvGrFQ/8AsQcv/gFa8KQHqYgHwYuIePAgilI8ScG2qPVRsI0varQNTdMkbZKdGQ8VtbabrM86ye93HTbZ+ex35wXL5vrLNEq4OEq8CIAACIAACIAACIAACIAACKA0y/rvbmjLIMTqrcu2ZQd7oJMXKAEEQAAEQAAEQADFCqBliQPITJGtBEU7ROA4eN02sIomMKscYAw6l4LOxKFiQ1DRK9DZ218CMF88AGLNeYhwF1iZf0kb81aDeavBq0JAsBP2+HXIiW6wXLw4AKz1NyBCB1xKeWBt6gJWNUPNvoQwHUAE+tx3/vubWbsXMlpu9iDIPJ2wwod/A2+H2a8AD/UAlq/AVKeh0x+hs7OA8IBXBADhLYLzAL4ZVuP2/LPcpyHIsdPQ2VuLrwv1QgT3mQ3A67vzPn0ZHYA9untpg3oOO3IQWtyF1bzH3DGA1bQ5pz6Xhv3qZP50RE4BMmsuAPcHnTs3OQzIgQKrwEeQsWcGJ8BX55yA6UF3W4FkxFAAVr/siu9rx1LD7gDSY4YC8I0AY84dy7hLAHLTZgIwXpXnsSpAjbpLgG0ogLZH8ukA8Bf5gYj+kH8Ks9rcJcmqMXcW0Pac8x+V73T3I76QwQAZ5/eXVbe7S0Blq7kAasZ5CuMNLnZ5rAmiod3gBCScB0JeuQ4i0FfgEOUimNfgMUDFbwLKdu5gyzGI4DWA/xBzaxdE+I75u0HYDyGnnkI0OsSYCVgbDsEKdkClooCcB8oqFs4DmMBK1B8/EZJvLhU+2xce8KogeG0LuL95xTr/VwB0+jLku3u/dm0uBTn5xGwAALAjRyAnH/9kdHKwR85ARs4B0GYDAEnYL/ZDvr+/sA8oNHgm3iI7fAIqcRZ67ipUfNzQQXBRnmOwxzogJ46CN3WB17aC+erBhAdaZoDsLFTiNdTUA6hYL4DkN5BoP3hN+J8AMPpkpsSLAAiAAAiAAAiAAAiAAAigROszfw/sXyvnr2MAAAAASUVORK5CYII="
        rel="icon" type="image/x-icon">
    <link rel="alternate" type="application/rss+xml" href="feed.xml" title="Implementing a ClickHouse output plugin for Telegraf in Go - d1823.pl">

    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="//matomo.1823.pl/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '2']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->
</head>
<body>

<header>
    <a href="/">
        <picture id="logo">
            <source media="(prefers-color-scheme: light) or (prefers-color-scheme: no-preference)" srcset="data:image/webp;base64,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">
            <img
                src="data:image/webp;base64,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"
                alt="d1823.pl logo">
        </picture>
    </a>

    <nav>
        <a href="/" class="link--current">Articles</a>
        <a href="/about" >About</a>
        <a href="https://github.com/d1823">
            Projects
            <svg class="icon icon__github" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
    </nav>
</header>

<section class="page">
    <div class="page__header">
        <div class="header__meta"><a href="/">&laquo; back</a> &mdash; from 27/08/2023, tags:
                                    <a href="tags/clickhouse">clickhouse</a>,                                     <a href="tags/go">go</a>,                                     <a href="tags/telegraf">telegraf</a>                                    </div>        <h1 class="header__title">Implementing a ClickHouse output plugin for Telegraf in Go</h1>
    </div>

    <div class="page__content">
        
<p>Telegraf describes itself as a server-based agent for collecting and sending all metrics and events from databases, systems &amp; IoT sensors. ClickHouse, on the other hand, is a column-oriented open-source database designed for real-time apps and analytics.</p>
<p>One of the clients I worked for has been using ClickHouse to store all kinds of telemetry captured throughout the infrastructure. Initially, they used InfluxDB as the storage, but as the infrastructure grew, they quickly found out they needed a more powerful solution than InfluxDB, and ClickHouse became a natural choice.</p>
<p>Its extreme performance and a collection of high-quality integrations with various systems have placed it at the very top of the ranking while they were evaluating the choices. One caveat, at the time, was the lack of any kind of mature integration between two of these systems.</p>
<h3 id="figuring-out-the-issues">Figuring out the issues</h3>
<p>Although Telegraf supported a lot of storage engines (called output plugins), it lacked <strong>proper</strong> support for ClickHouse. Well, to be completely honest, ClickHouse was supported through their SQL output plugin, but it was built on top of the Go&#x2019;s <a href="https://pkg.go.dev/database/sql">database/sql</a> API and suffered from a lot of shortcomings that affected its performance:</p>
<ul>
<li>it doesn&#x2019;t support using the <a href="https://github.com/ClickHouse/ch-go">ch-go</a> package designed for very fast data block streaming with low resources overhead</li>
<li>it doesn&#x2019;t support <a href="https://clickhouse.com/docs/en/optimize/asynchronous-inserts">asynchronous inserts</a> to lower the number of disk writes on the database side</li>
<li>it doesn&#x2019;t support <a href="https://github.com/influxdata/telegraf/blob/v1.27.4/plugins/outputs/sql/sql.go#L238-L256">metrics batching so every metric results in a insert statement</a></li>
</ul>
<p>All of that affected the memory usage of the Telegraf itself, and generated a huge number of disk-writes on the ClickHouse side, affecting the performance of the whole server.</p>
<p>That setup has been running in the production for a while, but eventually, a decision was made to take the matter into our own hands and implement a dedicated output plugin that would use some of ClickHouse-specific features, lowering the overall footprint on both sides of the integration.</p>
<h3 id="writing-the-plugin">Writing the plugin</h3>
<p>The pretty cool thing about Telegraf in itself is that it&#x2019;s heavily extendable. Every source and every storage engine integration is implemented as a plugin. As such, it can be brought into the project, becoming part of the source tree, or be implemented as an external plugin, integrated with telegraf through its <a href="https://github.com/influxdata/telegraf/blob/master/plugins/inputs/execd/README.md">execd wrapper</a>.</p>
<p>The communication is performed over the stdin/stdout as metrics are serialized into <a href="https://docs.influxdata.com/influxdb/v2.7/reference/syntax/line-protocol/">Influx Line Protocol</a>. For Go developers, there&#x2019;s a convenient <a href="https://github.com/influxdata/telegraf/blob/master/plugins/common/shim/README.md">execd shim package</a> that can be used to bootstrap the development of the desired integration. It takes care of reading &amp; writing the metrics using the native protocol, while the plugin itself needs to fulfill the following simplified interface:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">type</span> Output <span class="kw">interface</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  SampleConfig() <span class="dt">string</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>  Connect() <span class="dt">error</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>  Close() <span class="dt">error</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>  Write(metrics []Metric) <span class="dt">error</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>}</span></code></pre></div>
<p>Unfortunately, at the time of writing this article, the way the execd shim handles the incoming metrics prevents the implementations from processing them in any other way than one-by-one - a <a href="https://github.com/influxdata/telegraf/issues/11902">bug known to the maintainers, but yet to be resolved</a>, caused by <a href="https://github.com/influxdata/telegraf/blob/master/plugins/common/shim/output.go#L41-L50">this simple loop</a>. In my case, the most obvious workaround involved a timer-based buffer that called the output plugin with a list of accumulated metrics - something along these lines:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">func</span> (s *customShim) RunOutput() <span class="dt">error</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>  <span class="co">// omitted for brevity</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>  ch := <span class="bu">make</span>(<span class="kw">chan</span> telegraf.Metric, bufferSize)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>  wg := &amp;sync.WaitGroup{}</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>  wg.Add(<span class="dv">1</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>  <span class="kw">go</span> <span class="kw">func</span>() {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>    <span class="kw">defer</span> wg.Done()</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>    t := time.NewTicker(s.d)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>    <span class="kw">defer</span> t.Stop()</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a>    metrics := <span class="bu">make</span>([]telegraf.Metric, <span class="dv">0</span>, bufferSize)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a>    <span class="kw">defer</span> <span class="kw">func</span>() {</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a>      <span class="kw">if</span> err = s.Output.Write(metrics); err != <span class="ot">nil</span> {</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>        fmt.Fprintf(os.Stderr, <span class="st">"Failed to write metrics: %s</span><span class="ch">\n</span><span class="st">"</span>, err)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a>      }</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>    }()</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a>  loop:</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a>    <span class="kw">for</span> {</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a>      <span class="kw">select</span> {</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a>      <span class="kw">case</span> m, ok := &lt;-ch:</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true"></a>        <span class="kw">if</span> !ok {</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true"></a>          <span class="kw">break</span> loop</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true"></a>        }</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true"></a>        metrics = <span class="bu">append</span>(metrics, m)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true"></a>      <span class="kw">case</span> &lt;-t.C:</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true"></a>        <span class="kw">if</span> err = s.Output.Write(metrics); err != <span class="ot">nil</span> {</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true"></a>          fmt.Fprintf(os.Stderr, <span class="st">"Failed to write metrics: %s</span><span class="ch">\n</span><span class="st">"</span>, err)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true"></a>        }</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true"></a>        metrics = metrics[:<span class="dv">0</span>]</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true"></a>      }</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true"></a>    }</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true"></a>  }()</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true"></a>  scanner := bufio.NewScanner(os.Stdin)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true"></a>  <span class="kw">for</span> scanner.Scan() {</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true"></a>    m, err := parser.ParseLine(scanner.Text())</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true"></a>    <span class="kw">if</span> err != <span class="ot">nil</span> {</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true"></a>      fmt.Fprintf(os.Stderr, <span class="st">"Failed to parse metric: %s</span><span class="ch">\n</span><span class="st">"</span>, err)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true"></a>      <span class="kw">continue</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true"></a>    }</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true"></a>    ch &lt;- m</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true"></a>  }</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true"></a>  <span class="bu">close</span>(ch)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true"></a>  wg.Wait()</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true"></a>  <span class="kw">return</span> <span class="ot">nil</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true"></a>}</span></code></pre></div>
<p>The original intention of the authors behind the Telegraf project was to use it with their main product - InfluxDB, a time-series database where data is saved as a key-value set of fields and tags. One of the side-effects is the fact that it does not require an explicit schema, which is ideal for Telegraf, because metrics generated by input plugins are not bound to any schema either. That&#x2019;s not the case for any kind of SQL database, ClickHouse included. Creating the schema and keeping it up to date has to be part of the feature set.</p>
<p>Fortunately, doing it correctly was not a difficult task. To make things simple, each type of metric will be stored in a separate table. Given the interface of the output plugin, a quick scan over the given slice of metrics was enough to gather enough information about fields and tags that had to be supported by the corresponding table as columns. In the meantime, we also had to look at each column&#x2019;s value. A simple mapping from native Go types to their ClickHouse counterparts was enough to get this going.</p>
<p>Before constructing the insert query, we can use all that information to either create or alter the relevant table. The only thing I haven&#x2019;t decided to pursue was altering the existing columns - doing so could lead to a potential data loss and as such would be difficult to implement safely. To be honest, I&#x2019;m not sure it&#x2019;s even supported by the InfluxDB, let alone any other output plugin.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">func</span> (s *Clickhouse) Write(metrics []telegraf.Metric) <span class="dt">error</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>  tableCols := <span class="bu">make</span>(<span class="kw">map</span>[<span class="dt">string</span>]<span class="kw">map</span>[<span class="dt">string</span>]Datatype)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>  tableColValues := <span class="bu">make</span>(<span class="kw">map</span>[<span class="dt">string</span>][]<span class="kw">map</span>[<span class="dt">string</span>]<span class="kw">interface</span>{})</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>  <span class="kw">for</span> _, metric := <span class="kw">range</span> metrics {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>    batch := <span class="bu">make</span>(<span class="kw">map</span>[<span class="dt">string</span>]<span class="kw">interface</span>{})</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>    <span class="kw">if</span> tableCols[metric.Name()] == <span class="ot">nil</span> {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>      tableCols[metric.Name()] = <span class="bu">make</span>(<span class="kw">map</span>[<span class="dt">string</span>]Datatype, <span class="bu">len</span>(metric.Tags())+<span class="bu">len</span>(metric.FieldList())+<span class="dv">1</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>    }</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>    <span class="kw">if</span> s.TimestampColumn != <span class="st">""</span> {</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>      tableCols[metric.Name()][s.TimestampColumn] = resolveDatatype(metric.Time())</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>      batch[s.TimestampColumn] = metric.Time()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>    }</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a>    <span class="kw">for</span> column, value := <span class="kw">range</span> metric.Tags() {</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a>      tableCols[metric.Name()][column] = resolveDatatype(value)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a>      batch[column] = value</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a>    }</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a>    <span class="kw">for</span> column, value := <span class="kw">range</span> metric.Fields() {</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true"></a>      tableCols[metric.Name()][column] = resolveDatatype(value)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true"></a>      batch[column] = value</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true"></a>    }</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true"></a>    tableColValues[metric.Name()] = <span class="bu">append</span>(tableColValues[metric.Name()], batch)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true"></a>  }</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true"></a>  <span class="co">// omitted for brevity</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">func</span> resolveDatatype(value <span class="kw">interface</span>{}) Datatype {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>    <span class="kw">var</span> datatype Datatype</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    <span class="kw">switch</span> value.(<span class="kw">type</span>) {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">int64</span>:</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>        datatype = Integer</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">uint64</span>:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>        datatype = Unsigned</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">float64</span>:</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>        datatype = Real</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">string</span>:</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>        datatype = Text</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>    <span class="kw">case</span> <span class="dt">bool</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>        datatype = Bool</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>    <span class="kw">case</span> time.Time:</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>        datatype = Timestamp</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>    <span class="kw">default</span>:</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>        datatype = Default</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a>    }</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a>    <span class="kw">return</span> datatype</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a>}</span></code></pre></div>
<p>As for actually writing the metrics to the database, I used the <a href="https://clickhouse.com/docs/en/optimize/asynchronous-inserts">Asynchronous Inserts</a> functionality. In short, it enables ClickHouse to memory-buffer the inserted values before writing them to disk. It takes care of the issue created when it has to handle a lot of small and frequent inserts. To increase the performance of the whole solution, I&#x2019;ve made sure each batch of metrics converts into a single insert query per table. That way, even if I decide the async writes should no longer be enabled, the plugin will still execute - at most - a single insertion per table per second.</p>
<h3 id="lets-sum-it-up">Let&#x2019;s sum it up!</h3>
<p>It took me around two days to implement and deploy this solution to production. I&#x2019;ve lowered the memory footprint on the Telegraf side, and solved the excessive disk writes issue on the ClickHouse side. I&#x2019;ve also learned a bunch about Telegraf. My main takeaway from this little project is this - don&#x2019;t be afraid of writing integrations yourself, because it might actually be worth it.</p>

    </div>
</section>

<footer>
    <div>
        This site uses cookie-disabled, fully-anonymized, self-hosted Matomo for usage tracking.
    </div>

    <div>
        Copyright &copy; 2020-2023 1823.pl&nbsp;&mdash;&nbsp;<a
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a><br>
    </div>
</footer>

</body>
</html>
